<mat-sidenav-container class="sidenav-container">
  <mat-sidenav #sidenav mode="over" position="end" (openedChange)="onSidenavOpenedChange($event)">
    <div class="sidenav-header">
      <h2 id="documents-panel-heading">Documents</h2>
      <button mat-icon-button (click)="toggleSidenav()" aria-label="Close documents panel">
        <mat-icon aria-hidden="true">close</mat-icon>
      </button>
    </div>

    <!-- Status indicators -->
    <section aria-labelledby="document-status-heading">
      <h3 id="document-status-heading" class="sr-only">Document Storage Status</h3>
      <div class="status-container">
        <div class="status-row">
          <span class="status-label">Vector Store:</span>
          <mat-chip-set>
            <mat-chip
              variant="assist"
              [class.status-success]="metrics.vectorStoreName !== ''"
              [class.status-error]="metrics.vectorStoreName === ''"
              role="status"
              [attr.aria-label]="'Vector store status: ' + (metrics.vectorStoreName !== '' ? metrics.vectorStoreName : 'Not available')">
              <mat-icon matChipAvatar aria-hidden="true">{{ metrics.vectorStoreName !== '' ? 'check_circle' : 'error' }}</mat-icon>
              {{ metrics.vectorStoreName !== '' ? metrics.vectorStoreName : 'Not Available' }}
            </mat-chip>
          </mat-chip-set>
        </div>
        <div class="status-row">
          <span class="status-label">Embed Model:</span>
          <mat-chip-set>
            <mat-chip
              variant="assist"
              [class.status-success]="metrics.embeddingModel !== ''"
              [class.status-error]="metrics.embeddingModel === ''"
              role="status"
              [attr.aria-label]="'Embedding model status: ' + (metrics.embeddingModel !== '' ? metrics.embeddingModel : 'Not available')">
              <mat-icon matChipAvatar aria-hidden="true">{{ metrics.embeddingModel !== '' ? 'check_circle' : 'error' }}</mat-icon>
              {{ metrics.embeddingModel !== '' ? metrics.embeddingModel : 'Not Available' }}
            </mat-chip>
          </mat-chip-set>
        </div>
      </div>
    </section>

    <!-- Material Design Drag & Drop Upload Area -->
    <section aria-labelledby="upload-heading">
      <h3 id="upload-heading" class="sr-only">Upload Documents</h3>
      <div class="upload-container">
        <!-- Drag and Drop Zone -->
        <div class="drop-zone"
             [class.drag-over]="isDragOver()"
             [class.disabled]="isUploading || metrics.vectorStoreName === '' || metrics.embeddingModel === '' || isManualMode()"
             (dragenter)="onDragEnter($event)"
             (dragleave)="onDragLeave($event)"
             (dragover)="onDragOver($event)"
             (drop)="onDrop($event)"
             role="button"
             [tabindex]="(isUploading || metrics.vectorStoreName === '' || metrics.embeddingModel === '' || isManualMode()) ? -1 : 0"
             (click)="isManualMode() || isUploading || metrics.vectorStoreName === '' || metrics.embeddingModel === '' ? null : fileInput.click()"
             [attr.aria-label]="isDragOver() ? 'Drop your PDF here to upload' : (isManualMode() ? 'Upload disabled - manual document ID is active' : 'Click to upload PDF or drag and drop')"
             [attr.aria-disabled]="isUploading || metrics.vectorStoreName === '' || metrics.embeddingModel === '' || isManualMode()">>

          <!-- Drop Zone Content -->
          <div class="drop-zone-content">
            <mat-icon class="drop-zone-icon" aria-hidden="true">{{ isDragOver() ? 'file_download' : (isManualMode() ? 'block' : 'cloud_upload') }}</mat-icon>

            <div class="drop-zone-text">
              @if (isManualMode()) {
                <div class="drop-zone-title">Upload Disabled</div>
                <div class="drop-zone-subtitle">Manual document ID is active</div>
              } @else if (isDragOver()) {
                <div class="drop-zone-title">Drop your PDF here</div>
                <div class="drop-zone-subtitle">Release to upload</div>
              } @else {
                <div class="drop-zone-title">Drag & drop your PDF</div>
                <div class="drop-zone-subtitle">or click to browse files</div>
              }
            </div>

            <!-- Hidden file input -->
            <input hidden
                   (change)="onFileSelected($event)"
                   #fileInput
                   type="file"
                   accept=".pdf,application/pdf"
                   aria-label="Select PDF file to upload">

            <!-- Browse button -->
            <button mat-raised-button
                    color="primary"
                    (click)="fileInput.click(); $event.stopPropagation()"
                    [disabled]="isUploading || metrics.vectorStoreName === '' || metrics.embeddingModel === '' || isManualMode()"
                    class="browse-button"
                    aria-label="Browse for PDF files">
              <mat-icon aria-hidden="true">folder_open</mat-icon>
              Browse Files
            </button>
          </div>

          <!-- Supported formats info -->
          <div class="supported-formats" aria-label="Supported file formats">
            <mat-icon class="format-icon" aria-hidden="true">picture_as_pdf</mat-icon>
            <span>PDF files only â€¢ Max 50MB</span>
          </div>
        </div>

        <!-- Upload progress indicator -->
        @if (isUploading) {
          <div class="upload-progress-container" role="status" aria-live="polite" aria-label="File upload progress">
            <div class="upload-progress-header">
              <mat-icon class="upload-icon" aria-hidden="true">{{ getFileTypeIcon(currentFileName) }}</mat-icon>
              <div class="upload-info">
                <div class="file-name">{{ currentFileName }}</div>
                <div class="upload-status">Uploading...</div>
              </div>
            </div>
            <mat-progress-bar mode="determinate" [value]="uploadProgress" class="upload-progress-bar" [attr.aria-valuenow]="uploadProgress" aria-valuemin="0" aria-valuemax="100" [attr.aria-label]="'Upload progress: ' + uploadProgress + ' percent'"></mat-progress-bar>
            <div class="progress-percentage">{{ uploadProgress }}%</div>
          </div>
        }
      </div>
    </section>

    <!-- Documents List -->
    <section aria-labelledby="documents-list-heading">
      <div class="documents-list">
        <div class="documents-list-header">
          <h3 id="documents-list-heading">Uploaded Files ({{ documents.length }})</h3>
          @if (selectedDocumentId()) {
            <div class="selection-actions">
              <button mat-icon-button
                      (click)="selectedDocumentId.set(null)"
                      matTooltip="Clear selection"
                      aria-label="Clear document selection">
                <mat-icon aria-hidden="true">close</mat-icon>
              </button>
            </div>
          }
        </div>

        @if (documents.length === 0) {
          <div class="empty-state" role="status" aria-label="No documents uploaded">
            <mat-icon class="empty-state-icon" aria-hidden="true">folder_open</mat-icon>
            <div class="empty-state-text">No documents uploaded yet</div>
            <div class="empty-state-subtitle">Upload your first PDF to get started</div>
          </div>
        }

        <!-- Material Design 3 List with proper density -->
        <mat-list role="list"
                  [attr.aria-label]="'List of ' + documents.length + ' uploaded documents'"
                  class="document-list-container">
          @for (doc of documents; track doc.id) {
            <mat-list-item class="document-item"
                           role="listitem"
                           [class.selected]="isDocumentSelected(doc.id)"
                           [class.swiping]="swipingDocumentId() === doc.id"
                           [style.transform]="getDocumentItemTransform(doc.id)"
                           (click)="selectDocument(doc.id)"
                           (panstart)="onSwipeStart(doc.id, $event)"
                           (panmove)="onSwipeMove($event)"
                           (panend)="onSwipeEnd($event)"
                           [attr.aria-selected]="isDocumentSelected(doc.id)"
                           [attr.aria-label]="'Document: ' + doc.name + ', uploaded ' + formatDocumentDate(doc.uploadDate) + ', size ' + (doc.size | fileSize) + (isDocumentSelected(doc.id) ? ', selected' : '')"
                           tabindex="0"
                           role="option">

              <!-- Leading icon -->
              <mat-icon matListItemIcon
                        aria-hidden="true"
                        [class.selected-icon]="isDocumentSelected(doc.id)">
                {{ getFileTypeIcon(doc.name) }}
              </mat-icon>

              <!-- Two-line content layout following Material Design standards -->
              <div matListItemTitle class="document-title-container">
                <span class="document-title">{{ doc.name }}</span>
                <!-- Delete button positioned inline with title -->
                <button mat-icon-button
                        (click)="deleteDocument(doc.id); $event.stopPropagation()"
                        matTooltip="Delete document"
                        class="delete-button"
                        [attr.aria-label]="'Delete document: ' + doc.name">
                  <mat-icon aria-hidden="true">delete</mat-icon>
                </button>
              </div>
              <div matListItemLine class="document-subtitle">
                <span class="document-size">{{ doc.size | fileSize }}</span>
                <span class="document-date">{{ formatDocumentDate(doc.uploadDate) }}</span>
              </div>

              <!-- Swipe delete indicator (mobile only) -->
              @if (swipingDocumentId() === doc.id && swipeDistance() <= -40) {
                <div class="swipe-delete-indicator"
                     role="status"
                     aria-label="Swipe to delete">
                  <mat-icon aria-hidden="true">delete</mat-icon>
                  <span>Release to delete</span>
                </div>
              }
            </mat-list-item>
          }
        </mat-list>
      </div>
    </section>

    <!-- Clear Files button -->
    @if (documents.length > 0) {
      <div class="clear-files-container">
        <button mat-raised-button color="warn" (click)="deleteAllDocuments()" aria-label="Delete all uploaded documents">
          <mat-icon aria-hidden="true">delete_sweep</mat-icon> Clear All Files
        </button>
      </div>
    }

    <!-- Advanced Options Section -->
    <section aria-labelledby="advanced-options-heading" class="advanced-section">
      <mat-expansion-panel 
        [expanded]="isAdvancedSectionExpanded()"
        (opened)="isAdvancedSectionExpanded.set(true)"
        (closed)="isAdvancedSectionExpanded.set(false)"
        class="advanced-expansion-panel">
        <mat-expansion-panel-header>
          <mat-panel-title id="advanced-options-heading">
            <mat-icon class="advanced-icon" aria-hidden="true">settings</mat-icon>
            Advanced Options
          </mat-panel-title>
        </mat-expansion-panel-header>

        <div class="advanced-content">
          <!-- Info about manual mode -->
          <div class="advanced-info" role="status" aria-live="polite">
            <mat-icon class="info-icon" aria-hidden="true">info</mat-icon>
            <p class="info-text">
              For advanced users: Enter a document ID directly to bypass file uploads.
              @if (documents.length > 0) {
                <br><strong>Note:</strong> Delete all uploaded files first to enable this feature.
              }
            </p>
          </div>

          <!-- Manual Document ID input -->
          <mat-form-field appearance="outline" class="manual-id-field">
            <mat-label>Manual Document ID</mat-label>
            <input 
              matInput 
              [ngModel]="manualDocumentId()"
              (ngModelChange)="onManualDocumentIdChange($event)"
              [disabled]="documents.length > 0"
              placeholder="Enter document ID"
              aria-label="Manual document ID input"
              aria-describedby="manual-id-hint">
            <mat-hint id="manual-id-hint">
              @if (documents.length > 0) {
                <span class="disabled-hint">
                  <mat-icon class="hint-icon" aria-hidden="true">block</mat-icon>
                  Disabled - Delete uploaded files to enable
                </span>
              } @else if (isManualMode()) {
                <span class="active-hint">
                  <mat-icon class="hint-icon" aria-hidden="true">check_circle</mat-icon>
                  Active - File uploads disabled
                </span>
              } @else {
                Enter a document ID to use instead of uploaded files
              }
            </mat-hint>
          </mat-form-field>

          <!-- Warning when manual mode is active -->
          @if (isManualMode()) {
            <div class="manual-mode-warning" role="alert" aria-live="assertive">
              <mat-icon class="warning-icon" aria-hidden="true">warning</mat-icon>
              <div class="warning-content">
                <div class="warning-title">Manual Mode Active</div>
                <div class="warning-text">
                  Chat requests will use document ID: <strong>{{ manualDocumentId() }}</strong>
                  <br>
                  Clear the field above to re-enable file uploads.
                </div>
              </div>
            </div>
          }
        </div>
      </mat-expansion-panel>
    </section>
  </mat-sidenav>

  <mat-sidenav-content>
    <!-- This is intentionally empty -->
  </mat-sidenav-content>
</mat-sidenav-container>
