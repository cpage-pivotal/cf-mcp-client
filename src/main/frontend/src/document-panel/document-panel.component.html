<mat-sidenav-container class="sidenav-container">
  <mat-sidenav #sidenav mode="over" position="end">
    <div class="sidenav-header">
      <h2 id="documents-panel-heading">Documents</h2>
      <button mat-icon-button (click)="toggleSidenav()" matTooltip="Close panel" aria-label="Close documents panel">
        <mat-icon aria-hidden="true">close</mat-icon>
      </button>
    </div>

    <!-- Status indicators -->
    <section aria-labelledby="document-status-heading">
      <h3 id="document-status-heading" class="sr-only">Document Storage Status</h3>
      <div class="status-container">
        <div class="status-row">
          <span class="status-label">Vector Store:</span>
          <span class="status-indicator"
                [ngClass]="{'status-green': metrics.vectorStoreName !== '', 'status-red': metrics.vectorStoreName === ''}"
                role="status"
                [attr.aria-label]="'Vector store status: ' + (metrics.vectorStoreName !== '' ? metrics.vectorStoreName : 'Not available')">
            <mat-icon aria-hidden="true">{{ metrics.vectorStoreName !== '' ? 'check_circle' : 'error' }}</mat-icon>
            <span class="status-text">{{ metrics.vectorStoreName !== '' ? metrics.vectorStoreName : 'Not Available' }}</span>
          </span>
        </div>
        <div class="status-row">
          <span class="status-label">Embed Model:</span>
          <span class="status-indicator"
                [ngClass]="{'status-green': metrics.embeddingModel !== '', 'status-red': metrics.embeddingModel === ''}"
                role="status"
                [attr.aria-label]="'Embedding model status: ' + (metrics.embeddingModel !== '' ? metrics.embeddingModel : 'Not available')">
            <mat-icon aria-hidden="true">{{ metrics.embeddingModel !== '' ? 'check_circle' : 'error' }}</mat-icon>
            <span class="status-text">{{ metrics.embeddingModel !== '' ? metrics.embeddingModel : 'Not Available' }}</span>
          </span>
        </div>
      </div>
    </section>

    <!-- Material Design Drag & Drop Upload Area -->
    <section aria-labelledby="upload-heading">
      <h3 id="upload-heading" class="sr-only">Upload Documents</h3>
      <div class="upload-container">
        <!-- Drag and Drop Zone -->
        <div class="drop-zone"
             [class.drag-over]="isDragOver()"
             [class.disabled]="isUploading || metrics.vectorStoreName === '' || metrics.embeddingModel === ''"
             (dragenter)="onDragEnter($event)"
             (dragleave)="onDragLeave($event)"
             (dragover)="onDragOver($event)"
             (drop)="onDrop($event)"
             role="button"
             tabindex="0"
             (click)="fileInput.click()"
             [attr.aria-label]="isDragOver() ? 'Drop your PDF here to upload' : 'Click to upload PDF or drag and drop'"
             [attr.aria-disabled]="isUploading || metrics.vectorStoreName === '' || metrics.embeddingModel === ''">

          <!-- Drop Zone Content -->
          <div class="drop-zone-content">
            <mat-icon class="drop-zone-icon" aria-hidden="true">{{ isDragOver() ? 'file_download' : 'cloud_upload' }}</mat-icon>

            <div class="drop-zone-text">
              @if (isDragOver()) {
                <div class="drop-zone-title">Drop your PDF here</div>
                <div class="drop-zone-subtitle">Release to upload</div>
              } @else {
                <div class="drop-zone-title">Drag & drop your PDF</div>
                <div class="drop-zone-subtitle">or click to browse files</div>
              }
            </div>

            <!-- Hidden file input -->
            <input hidden
                   (change)="onFileSelected($event)"
                   #fileInput
                   type="file"
                   accept=".pdf,application/pdf"
                   aria-label="Select PDF file to upload">

            <!-- Browse button -->
            <button mat-raised-button
                    color="primary"
                    (click)="fileInput.click(); $event.stopPropagation()"
                    [disabled]="isUploading || metrics.vectorStoreName === '' || metrics.embeddingModel === ''"
                    class="browse-button"
                    aria-label="Browse for PDF files">
              <mat-icon aria-hidden="true">folder_open</mat-icon>
              Browse Files
            </button>
          </div>

          <!-- Supported formats info -->
          <div class="supported-formats" aria-label="Supported file formats">
            <mat-icon class="format-icon" aria-hidden="true">picture_as_pdf</mat-icon>
            <span>PDF files only â€¢ Max 50MB</span>
          </div>
        </div>

        <!-- Upload progress indicator -->
        @if (isUploading) {
          <div class="upload-progress-container" role="status" aria-live="polite" aria-label="File upload progress">
            <div class="upload-progress-header">
              <mat-icon class="upload-icon" aria-hidden="true">{{ getFileTypeIcon(currentFileName) }}</mat-icon>
              <div class="upload-info">
                <div class="file-name">{{ currentFileName }}</div>
                <div class="upload-status">Uploading...</div>
              </div>
            </div>
            <mat-progress-bar mode="determinate" [value]="uploadProgress" class="upload-progress-bar" [attr.aria-valuenow]="uploadProgress" aria-valuemin="0" aria-valuemax="100" [attr.aria-label]="'Upload progress: ' + uploadProgress + ' percent'"></mat-progress-bar>
            <div class="progress-percentage">{{ uploadProgress }}%</div>
          </div>
        }
      </div>
    </section>

    <!-- Documents List -->
    <section aria-labelledby="documents-list-heading">
      <div class="documents-list">
        <h3 id="documents-list-heading">Uploaded Files ({{ documents.length }})</h3>

        @if (documents.length === 0) {
          <div class="empty-state" role="status" aria-label="No documents uploaded">
            <mat-icon class="empty-state-icon" aria-hidden="true">folder_open</mat-icon>
            <div class="empty-state-text">No documents uploaded yet</div>
            <div class="empty-state-subtitle">Upload your first PDF to get started</div>
          </div>
        }

        <mat-list role="list" [attr.aria-label]="'List of ' + documents.length + ' uploaded documents'">
          @for (doc of documents; track doc.id) {
            <mat-list-item class="document-item" role="listitem">
              <mat-icon matListItemIcon aria-hidden="true">{{ getFileTypeIcon(doc.name) }}</mat-icon>
              <div matListItemTitle>{{ doc.name }}</div>
              <div matListItemLine>{{ doc.size | fileSize }}</div>
              <button mat-icon-button
                      matListItemMeta
                      (click)="deleteDocument(doc.id)"
                      matTooltip="Delete document"
                      class="delete-button"
                      [attr.aria-label]="'Delete document: ' + doc.name">
                <mat-icon aria-hidden="true">delete</mat-icon>
              </button>
            </mat-list-item>
          }
        </mat-list>
      </div>
    </section>

    <!-- Clear Files button -->
    @if (documents.length > 0) {
      <div class="clear-files-container">
        <button mat-raised-button color="warn" (click)="deleteAllDocuments()" aria-label="Delete all uploaded documents">
          <mat-icon aria-hidden="true">delete_sweep</mat-icon> Clear All Files
        </button>
      </div>
    }
  </mat-sidenav>

  <mat-sidenav-content>
    <!-- This is intentionally empty -->
  </mat-sidenav-content>
</mat-sidenav-container>
