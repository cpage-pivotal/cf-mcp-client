<div class="agents-container">
  <button mat-icon-button class="toggle-button" (click)="toggleSidenav()" matTooltip="Agents" matTooltipPosition="left">
    <mat-icon>smart_toy</mat-icon>
  </button>
</div>

<mat-sidenav-container class="sidenav-container">
  <mat-sidenav #sidenav mode="over" position="end" fixedInViewport="true">
    <div class="sidenav-header">
      <h2>Agents</h2>
      <button mat-icon-button (click)="sidenav.close()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="agent-selection-container">
      <div class="agent-card selected" [class.selected]="selectedAgent === 'reviewer'">
        <div class="agent-info">
          <div class="agent-avatar">
            <mat-icon class="agent-icon">rate_review</mat-icon>
          </div>
          <div class="agent-details">
            <h3 class="agent-name">Reviewer</h3>
            <p class="agent-description">Code review and analysis agent</p>
          </div>
        </div>
        <div class="agent-status">
          <span class="status-indicator" 
                [ngClass]="{'status-green': isConnected, 'status-red': !isConnected}">
            <mat-icon>{{ isConnected ? 'check_circle' : 'error' }}</mat-icon>
            <span class="status-text">{{ isConnected ? 'Connected' : 'Disconnected' }}</span>
          </span>
        </div>
      </div>
    </div>

    <div class="agent-interaction-container">
      <!-- Message History -->
      <div class="message-history" *ngIf="messages.length > 0">
        <div class="message-header">
          <h3>Conversation with {{ selectedAgent | titlecase }}</h3>
          <button mat-icon-button (click)="clearMessages()" matTooltip="Clear conversation">
            <mat-icon>clear_all</mat-icon>
          </button>
        </div>
        
        <div class="messages-container">
          <div *ngFor="let message of messages" 
               class="message" 
               [ngClass]="{
                 'user-message': message.sender === 'user',
                 'agent-message': message.sender === 'agent',
                 'error-message': message.isError
               }">
            <div class="message-avatar">
              <mat-icon *ngIf="message.sender === 'user'">person</mat-icon>
              <mat-icon *ngIf="message.sender === 'agent'" class="agent-avatar-icon">smart_toy</mat-icon>
            </div>
            <div class="message-content">
              <div class="message-header-small">
                <span class="sender-name">{{ message.sender === 'user' ? 'You' : (message.agentType | titlecase) }}</span>
                <span class="message-time">{{ message.timestamp | date:'HH:mm:ss' }}</span>
              </div>
              <div class="message-text">{{ message.content }}</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" *ngIf="messages.length === 0">
        <mat-icon class="empty-icon">smart_toy</mat-icon>
        <h3>Start a conversation with {{ selectedAgent | titlecase }}</h3>
        <p>Send a message to begin interacting with the {{ selectedAgent }} agent</p>
      </div>

      <!-- Input Area -->
      <div class="input-container">
        <mat-form-field appearance="outline" class="message-input">
          <mat-label>Type your message...</mat-label>
          <textarea 
            matInput 
            [(ngModel)]="currentPrompt" 
            (keydown)="onKeyPress($event)"
            [disabled]="isLoading"
            placeholder="Ask the {{ selectedAgent }} agent for help..."
            rows="3">
          </textarea>
        </mat-form-field>
        
        <div class="input-actions">
          <button 
            mat-raised-button 
            color="primary" 
            (click)="sendMessage()"
            [disabled]="!currentPrompt.trim() || isLoading"
            class="send-button">
            <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
            <mat-icon *ngIf="!isLoading">send</mat-icon>
            {{ isLoading ? 'Sending...' : 'Send' }}
          </button>
        </div>
      </div>
    </div>
  </mat-sidenav>

  <mat-sidenav-content>
    <!-- This is intentionally empty -->
  </mat-sidenav-content>
</mat-sidenav-container>