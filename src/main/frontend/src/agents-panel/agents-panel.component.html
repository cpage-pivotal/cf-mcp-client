<!-- Agent Panel Container -->
<div class="agents-container">
  <button mat-icon-button class="toggle-button" (click)="toggleSidenav()" matTooltip="Agents" matTooltipPosition="left">
    <mat-icon>smart_toy</mat-icon>
  </button>
</div>

<mat-sidenav-container class="sidenav-container">
  <mat-sidenav #sidenav mode="over" position="end" fixedInViewport="true">
    <div class="sidenav-header">
      <h2>AI Agents</h2>
      <button mat-icon-button (click)="sidenav.close()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Agent System Status -->
    <div class="agent-status-section">
      <h3>Agent System Status</h3>
      <div class="system-status">
        <div class="status-indicator"
             [ngClass]="{
               'status-green': isConnected(),
               'status-red': !isConnected()
             }">
          <mat-icon>{{ isConnected() ? 'check_circle' : 'error' }}</mat-icon>
          <span class="status-text">{{ isConnected() ? 'Connected' : 'Disconnected' }}</span>
        </div>
        <div class="status-details">
          <p>Implementation: {{ agentStatus().implementation | titlecase }}</p>
          <p>Active Handlers: {{ agentStatus().activeHandlers }}</p>
          <p *ngIf="agentStatus().message" class="status-message">{{ agentStatus().message }}</p>
        </div>
      </div>
    </div>

    <!-- Agent Selection Section (only show if connected) -->
    <div class="agent-selection-container" *ngIf="isConnected()">
      <h3>Available Agents</h3>
      <p class="selection-help">Select an agent to start a conversation in the chat panel</p>
      
      <div class="agents-grid">
        <div *ngFor="let agent of availableAgents(); trackBy: trackByAgent"
             class="agent-card"
             [ngClass]="{
               'selected': isAgentSelected(agent),
               'available': agent.status === 'connected',
               'busy': agent.status === 'busy',
               'disconnected': agent.status === 'disconnected'
             }"
             (click)="selectAgent(agent)">
          
          <!-- Agent Icon -->
          <div class="agent-icon" [style.background-color]="agent.color">
            <mat-icon>{{ agent.icon || 'smart_toy' }}</mat-icon>
          </div>
          
          <!-- Agent Info -->
          <div class="agent-info">
            <h4 class="agent-name">{{ agent.name }}</h4>
            <p class="agent-description">{{ agent.description }}</p>
            
            <!-- Agent Status -->
            <div class="agent-status-badge"
                 [ngClass]="'status-' + agent.status">
              <mat-icon class="status-icon">
                {{ agent.status === 'connected' ? 'check_circle' : 
                   agent.status === 'busy' ? 'schedule' : 'error' }}
              </mat-icon>
              <span>{{ agent.status | titlecase }}</span>
            </div>
          </div>
          
          <!-- Selection Indicator -->
          <div class="selection-indicator" *ngIf="isAgentSelected(agent)">
            <mat-icon>check</mat-icon>
          </div>
        </div>
      </div>
      
    </div>

    <!-- Disconnected State -->
    <div *ngIf="!isConnected()" class="disconnected-state">
      <mat-icon class="large-icon">cloud_off</mat-icon>
      <h3>Agent System Unavailable</h3>
      <p>{{ agentStatus().message }}</p>
      <p class="help-text">
        The messaging system needs to be configured for agent communication.
        <span *ngIf="agentStatus().implementation === 'none'">
          Please configure RabbitMQ or enable in-memory messaging.
        </span>
      </p>
    </div>
  </mat-sidenav>

  <mat-sidenav-content>
    <!-- This is intentionally empty -->
  </mat-sidenav-content>
</mat-sidenav-container>
