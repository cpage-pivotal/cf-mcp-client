<!-- Agent Panel Container -->
<div class="agents-container">
  <button mat-icon-button class="toggle-button" (click)="toggleSidenav()" matTooltip="Agents" matTooltipPosition="left">
    <mat-icon>smart_toy</mat-icon>
  </button>
</div>

<mat-sidenav-container class="sidenav-container">
  <mat-sidenav #sidenav mode="over" position="end" fixedInViewport="true">
    <div class="sidenav-header">
      <h2>AI Agents</h2>
      <button mat-icon-button (click)="sidenav.close()">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <div class="status-container">
      <div class="status-row">
        <span class="status-label">RabbitMQ:</span>
        <span class="status-indicator" [ngClass]="{'status-green': isConnected(), 'status-red': !isConnected()}">
          <mat-icon>{{ isConnected() ? 'check_circle' : 'error' }}</mat-icon>
          <span class="status-text">{{ isConnected() ? 'Connected' : 'Disconnected' }}</span>
        </span>
      </div>
    </div>

    <!-- Agent Selection Section (only show if connected) -->
    @if (isConnected()) {
      <div class="agent-selection-container">
        <h3>Available Agents</h3>
        <p class="selection-help">Select an agent to start a conversation in the chat panel</p>

        <div class="agents-grid">
          @for (agent of availableAgents(); track trackByAgent($index, agent)) {
            <div class="agent-card"
                 [ngClass]="{
                   'selected': isAgentSelected(agent),
                   'available': agent.status === 'available',
                   'busy': agent.status === 'busy',
                   'offline': agent.status === 'offline',
                   'error': agent.status === 'error'
                 }"
                 (click)="selectAgent(agent)">

              <!-- Agent Icon -->
              <div class="agent-icon" [style.background-color]="agent.color">
                <mat-icon>{{ agent.icon || 'smart_toy' }}</mat-icon>
              </div>

              <!-- Agent Info -->
              <div class="agent-info">
                <h4 class="agent-name">{{ agent.name }}</h4>
                <p class="agent-description">{{ agent.description }}</p>

                <!-- Agent Status -->
<!--                <div class="agent-status-badge"-->
<!--                     [ngClass]="'status-' + agent.status">-->
<!--                  <mat-icon class="status-icon">-->
<!--                    {{ agent.status === 'available' ? 'check_circle' :-->
<!--                    agent.status === 'busy' ? 'schedule' :-->
<!--                      agent.status === 'offline' ? 'offline_bolt' : 'error' }}-->
<!--                  </mat-icon>-->
<!--                  <span>{{ getStatusLabel(agent.status) }}</span>-->
<!--                </div>-->
              </div>

              <!-- Selection Indicator -->
              @if (isAgentSelected(agent)) {
                <div class="selection-indicator">
                  <mat-icon>check</mat-icon>
                </div>
              }
            </div>
          }
        </div>

      </div>
    }

    <!-- Disconnected State -->
    @if (!isConnected()) {
      <div class="disconnected-state">
        <mat-icon class="large-icon">cloud_off</mat-icon>
        <h3>Agent System Unavailable</h3>
        <p>{{ agentStatus().message }}</p>
        <p class="help-text">
          The messaging system needs to be configured for agent communication.
          @if (agentStatus().implementation === 'none') {
            <span>
              Please configure RabbitMQ or enable in-memory messaging.
            </span>
          }
        </p>
      </div>
    }
  </mat-sidenav>

  <mat-sidenav-content>
    <!-- This is intentionally empty -->
  </mat-sidenav-content>
</mat-sidenav-container>
