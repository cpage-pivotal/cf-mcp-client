<mat-sidenav-container class="sidenav-container">
  <mat-sidenav #sidenav position="end" mode="over" fixedInViewport="true" [fixedTopGap]="64"
               (openedChange)="onSidenavOpenedChange($event)">
    <div class="panel-header">
      <h2 id="agents-panel-heading">Agents</h2>
      <button mat-icon-button (click)="toggleSidenav()" aria-label="Close agents panel">
        <mat-icon aria-hidden="true">close</mat-icon>
      </button>
    </div>

    <section aria-labelledby="agent-status-heading">
      <h3 id="agent-status-heading" class="sr-only">Agent Status</h3>
      <div class="status-container">
        <div class="status-row">
          <span class="status-label">Status:</span>
          <mat-chip-set>
            <mat-chip
              variant="assist"
              [class.status-success]="getOverallStatusClass() === 'status-green'"
              [class.status-warning]="getOverallStatusClass() === 'status-orange'"
              [class.status-error]="getOverallStatusClass() === 'status-red'"
              role="status"
              [attr.aria-label]="'Agent status: ' + getOverallStatusText()">
              <mat-icon matChipAvatar aria-hidden="true">{{ getOverallStatusIcon() }}</mat-icon>
              {{ getOverallStatusText() }}
            </mat-chip>
          </mat-chip-set>
        </div>
      </div>
    </section>

    @if (sortedA2AAgents.length > 0) {
      <section aria-labelledby="available-agents-heading">
        <div class="agents-list">
          <h3 id="available-agents-heading">Available Agents</h3>
          <div class="agent-cards" role="list" [attr.aria-label]="'List of ' + sortedA2AAgents.length + ' agents'">
            @for (agent of sortedA2AAgents; track agent.serviceName) {
              <mat-card class="agent-card"
                        [class.unhealthy]="!agent.healthy"
                        role="listitem"
                        [attr.aria-label]="'Agent: ' + agent.agentName + ', Status: ' + (agent.healthy ? 'Healthy' : 'Unhealthy')">
                <mat-card-header>
                  <mat-card-title>{{agent.agentName}}</mat-card-title>
                  <mat-card-subtitle>{{agent.version}}</mat-card-subtitle>
                </mat-card-header>

                <mat-card-content>
                  <p class="agent-description">{{agent.description}}</p>

                  @if (agent.capabilities.streaming || agent.capabilities.pushNotifications || agent.capabilities.stateTransitionHistory) {
                    <div class="capabilities" role="list" aria-label="Agent capabilities">
                      @if (agent.capabilities.streaming) {
                        <mat-chip role="listitem">Streaming</mat-chip>
                      }
                      @if (agent.capabilities.pushNotifications) {
                        <mat-chip role="listitem">Push Notifications</mat-chip>
                      }
                      @if (agent.capabilities.stateTransitionHistory) {
                        <mat-chip role="listitem">State History</mat-chip>
                      }
                    </div>
                  }

                  @if (!agent.healthy) {
                    <div class="error-message" role="alert">
                      <mat-icon aria-hidden="true">error</mat-icon>
                      <span>{{agent.errorMessage}}</span>
                    </div>
                  }
                </mat-card-content>

                <mat-card-actions>
                  <button mat-raised-button
                          color="primary"
                          [disabled]="!agent.healthy"
                          (click)="openAgentMessageDialog(agent)"
                          [attr.aria-label]="agent.healthy ? 'Send message to ' + agent.agentName : 'Cannot send message - agent is unhealthy'">
                    <mat-icon aria-hidden="true">send</mat-icon>
                    Send Message
                  </button>
                </mat-card-actions>
              </mat-card>
            }
          </div>
        </div>
      </section>
    }

    @if (sortedA2AAgents.length === 0) {
      <div class="empty-state" role="status" aria-label="No agents configured">
        <mat-icon aria-hidden="true">info</mat-icon>
        <p>No A2A agents configured</p>
        <p class="empty-state-hint">Bind A2A services to enable agent interactions</p>
      </div>
    }
  </mat-sidenav>

  <mat-sidenav-content>
    <!-- This is intentionally empty -->
  </mat-sidenav-content>
</mat-sidenav-container>
