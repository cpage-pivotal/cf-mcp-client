<div class="chatbox" id="chatbox">
  <div #chatboxMessages class="chatbox-messages">
    <!-- Chat messages will be dynamically inserted here -->
    @for (message of messages; track message) {
      <div class="chat-message {{message.persona}}">
        <mat-card appearance="outlined"
                  [style.background-color]="message.persona == 'user' ? 'var(--mat-sys-primary-container)' :
                                          message.persona == 'zantu' ? 'var(--mat-sys-tertiary-container)' :
                                          'var(--mat-sys-surface)'">
          <mat-card-content>
            @if (message.persona == 'user') {
              {{ message.text }}
            } @else if (message.persona == 'zantu') {
              @if (message.typing) {
                <div class="typing__dot"></div><div class="typing__dot"></div><div class="typing__dot"></div>
              } @else {
                <div class="zantu-header">
                  <mat-icon>smart_toy</mat-icon>
                  <span>Zantu</span>
                </div>
                <markdown [data]="message.text"></markdown>
              }
            } @else {
              @if (message.typing) {
                <div class="typing__dot"></div><div class="typing__dot"></div><div class="typing__dot"></div>
              } @else {
                <markdown [data]="message.text"></markdown>
              }
            }
          </mat-card-content>
        </mat-card>
      </div>
    }
  </div>
  <div class="chatbox-footer">
    <ng-form class="chat-input-form">
      <mat-form-field class="chat-input-field">
        <input name="chatbox-input"
               [placeholder]="zantuMode ? 'Ask Zantu...' : 'Type a message...'"
               matInput
               [(ngModel)]="chatMessage"
               type="text"
               (keydown.enter)="sendChatMessage()">
      </mat-form-field>

      <mat-slide-toggle
        name="zantu-toggle"
        class="zantu-toggle"
        [(ngModel)]="zantuMode"
        color="accent"
        [disabled]="!isZantuAvailable()"
        matTooltip="Chat with Zantu">
        <mat-icon>smart_toy</mat-icon>
      </mat-slide-toggle>

      <button mat-flat-button
              type="button"
              (click)="sendChatMessage()"
              class="send-button"
              [color]="zantuMode ? 'accent' : 'primary'">
        @if (zantuMode) {
          <mat-icon>smart_toy</mat-icon>
        }
        Send
      </button>
    </ng-form>
  </div>
</div>
